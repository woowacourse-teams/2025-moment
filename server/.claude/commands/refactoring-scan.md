# 리팩토링 대상 탐색

코드베이스를 분석하여 리팩토링이 필요한 부분을 자동으로 탐지하고 우선순위와 함께 보고합니다.

## 사용법

```
/refactoring-scan [탐색 범위]
```

**예시**:
- `/refactoring-scan` - 전체 코드베이스 스캔
- `/refactoring-scan admin` - Admin 모듈만 스캔
- `/refactoring-scan user moment` - 특정 모듈들 스캔

## Instructions

다음 범위에서 리팩토링 대상을 탐색합니다: **$ARGUMENTS**

(범위가 지정되지 않으면 전체 `src/main/java/moment` 디렉토리를 스캔합니다)

---

## 탐색 범위 설정

### 범위 결정
- 인자가 없으면: 전체 `src/main/java/moment/**/*.java` 스캔
- 모듈명이면: `src/main/java/moment/{모듈}/**/*.java` 스캔
- 경로가 지정되면: 해당 경로 스캔

### 제외 대상
- `**/dto/**` - DTO는 단순 데이터 컨테이너
- `**/config/**` - 설정 클래스는 별도 검토
- `**/*Test.java` - 테스트 코드는 별도 검토

---

## 탐지 카테고리

4개의 상위 카테고리로 분류하여 탐지합니다. 각 카테고리의 **원칙과 관점**을 기준으로 문제를 식별하되, 아래 나열된 항목에 국한되지 않고 해당 원칙에 위배되는 모든 패턴을 탐지합니다.

---

## 1️⃣ CODE QUALITY (코드 품질)

### 핵심 질문
> "이 코드는 읽기 쉽고, 이해하기 쉽고, 유지보수하기 쉬운가?"

### 탐지 관점

**가독성과 명확성**
- 코드를 읽었을 때 의도가 즉시 파악되는가?
- 메서드/클래스/변수의 이름이 역할을 명확히 설명하는가?
- 불필요한 복잡성이 존재하는가?

**크기와 책임**
- 메서드나 클래스가 한 가지 일에 집중하는가?
- 코드의 크기가 인지 부하를 일으키지 않는가?
- 중복 코드가 존재하는가?

**테스트 가능성**
- 해당 코드에 대한 테스트가 존재하는가?
- 테스트가 의미 있는 검증을 수행하는가?
- 경계 조건과 예외 상황이 테스트되는가?

### 대표적 스멜 (참고용, 이에 국한되지 않음)
- Long Method, Large Class, Duplicate Code
- God Class, Feature Envy, Dead Code
- 복잡한 조건문, 불명확한 네이밍

### 심각도: 🟡 Medium ~ 🟢 Low

---

## 2️⃣ ARCHITECTURE (아키텍처 준수)

### 핵심 질문
> "이 코드는 프로젝트의 아키텍처 원칙과 설계 규칙을 준수하는가?"

### 탐지 관점

**레이어 경계**
- Clean Architecture의 의존성 방향이 지켜지는가?
- 각 레이어가 자신의 책임 범위 내에서만 동작하는가?
- 레이어 간 결합도가 적절한가?

**프로젝트 규칙 준수** (CLAUDE.md 기반)
- Soft Delete 패턴이 적용되어 있는가?
- 생성자 주입을 사용하는가?
- DTO를 통한 데이터 전달이 이루어지는가?
- 트랜잭션 경계가 올바른 위치에 있는가?
- 이벤트 기반 비동기 처리가 적용되어야 할 곳에 적용되었는가?

**설계 원칙**
- SOLID 원칙이 지켜지는가?
- 컴포넌트 간 응집도와 결합도가 적절한가?
- 확장에 열려 있고 수정에 닫혀 있는가?

### 대표적 위반 (참고용, 이에 국한되지 않음)
- 레이어 위반 (Domain→Infrastructure 의존)
- 컨트롤러 비즈니스 로직, 필드 주입
- Hard Delete, 엔티티 직접 반환

### 심각도: 🔴 High

---

## 3️⃣ PERFORMANCE (성능 최적화)

### 핵심 질문
> "이 코드는 프로덕션 환경에서 효율적으로 동작하는가?"

### 탐지 관점

**데이터베이스 효율성**
- 필요 이상의 데이터를 조회하고 있지 않은가?
- 반복문 내에서 쿼리가 실행되는 패턴이 있는가?
- 연관 엔티티 접근 시 적절한 페칭 전략을 사용하는가?
- 대량 데이터 조회 시 페이징이 적용되어 있는가?

**리소스 관리**
- 메모리 누수 가능성이 있는가?
- 리소스(연결, 스트림 등)가 적절히 해제되는가?
- 캐시가 무한히 증가할 가능성이 있는가?

**동시성과 안정성**
- 멀티스레드 환경에서 안전한가?
- Race condition이 발생할 수 있는 패턴이 있는가?
- 트랜잭션 격리 수준이 적절한가?

**알고리즘 효율성**
- 시간/공간 복잡도가 적절한가?
- 불필요한 연산이 반복되고 있지 않은가?

### 대표적 문제 (참고용, 이에 국한되지 않음)
- N+1 쿼리, Fetch Join 누락
- findAll() 후 필터링, 페이징 없는 대량 조회
- Static 컬렉션 누수, 공유 가변 상태

### 심각도: 🔴 High (DB 성능) ~ 🟡 Medium (일반)

---

## 4️⃣ SECURITY (보안 & 규정)

### 핵심 질문
> "이 코드는 보안 위협으로부터 안전하고, 민감 정보를 적절히 보호하는가?"

### 탐지 관점

**입력 처리**
- 사용자 입력이 검증되고 있는가?
- SQL, XSS, 명령어 주입 등의 공격에 취약하지 않은가?
- 신뢰할 수 없는 데이터를 안전하게 처리하는가?

**인증과 권한**
- 리소스 접근 시 권한 확인이 이루어지는가?
- 인증 없이 접근 가능한 민감한 엔드포인트가 있는가?
- 권한 우회 가능성이 있는가?

**민감 정보 보호**
- 비밀번호, API 키, 토큰 등이 하드코딩되어 있지 않은가?
- 로그에 민감 정보가 출력되지 않는가?
- 응답에 불필요한 민감 정보가 포함되지 않는가?

**의존성 보안**
- 알려진 취약점이 있는 라이브러리를 사용하고 있지 않은가?

### 대표적 취약점 (참고용, 이에 국한되지 않음)
- SQL Injection, XSS
- 민감 정보 하드코딩/로깅
- @Valid 누락, 권한 검사 누락

### 심각도: 🔴 Critical

---

## 심각도 기준

| 심각도 | 아이콘 | 적용 대상 | 조치 시점 |
|--------|--------|----------|----------|
| Critical | 🔴 | 보안 취약점 | 즉시 수정 |
| High | 🔴 | 아키텍처 위반, DB 성능 문제 | 우선 수정 |
| Medium | 🟡 | 코드 품질, 일반 성능 | 관련 작업 시 함께 |
| Low | 🟢 | 컨벤션, 테스트 보완 | 점진적 개선 |

---

## 탐지 프로세스

1. **파일 스캔**: 지정된 범위의 Java 파일 수집
2. **카테고리별 분석**: 각 카테고리의 핵심 질문과 관점을 기준으로 코드 분석
3. **문제 식별**: 원칙에 위배되는 패턴 식별 (나열된 예시에 국한되지 않음)
4. **심각도 분류**: 발견된 문제를 심각도별로 분류
5. **결과 보고**: 우선순위에 따라 정리된 보고서 생성

---

## 결과 보고 형식

```markdown
# 리팩토링 대상 탐색 결과

> 스캔 일시: YYYY-MM-DD HH:mm
> 스캔 범위: [범위]
> 분석 파일 수: N개

## 요약

| 카테고리 | 발견 건수 | 최고 심각도 |
|----------|-----------|-------------|
| CODE QUALITY | N건 | 🟡/🟢 |
| ARCHITECTURE | N건 | 🔴 |
| PERFORMANCE | N건 | 🔴/🟡 |
| SECURITY | N건 | 🔴 |

## 🔴 즉시 개선 필요 (Critical/High)

### [문제 제목]
- **위치**: `파일경로:라인번호`
- **카테고리**: [카테고리]
- **문제**: [문제 설명]
- **영향**: [잠재적 영향]
- **권장 조치**: [개선 방안]

## 🟡 개선 권장 (Medium)
...

## 🟢 개선 고려 (Low)
...

## 다음 단계
- `/code_refactor [대상]` - 리팩토링 수행
- `/refactoring-report [대상]` - 상세 보고서
```

---

## 결과 저장

- **경로**: `.claude/docs/refactor/scan/`
- **파일명**: `YYYYMMDD-HHmm-[범위]-스캔결과.md`

---

## 참고

### 관련 명령어
- `/code_refactor` - 리팩토링 실행
- `/refactoring-report` - 상세 보고서 생성

### 제외 항목
- 외부 라이브러리 코드
- Lombok, MapStruct 등 생성 코드
- 명시적으로 제외된 레거시 코드
